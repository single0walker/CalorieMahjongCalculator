<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Calorie Mahjong Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link id="themeStyle" rel="stylesheet" href="">
<script>
  (function () {
    const styles = ['CRT_Green.css', 'Dopamine.css', 'Neon.css', 'Normal.css'];
    const randomStyle = styles[Math.floor(Math.random() * styles.length)];
    document.getElementById('themeStyle').href = '/css/' + randomStyle;
  })();
</script>
  <style>
    @keyframes fly {
      0% {
        transform: scale(1) translate(0, 0);
        opacity: 1;
      }

      100% {
        transform: scale(1.5) translate(var(--x), var(--y));
        opacity: 0;
      }
    }


    @media (min-width: 769px) {
      .line1 {
        display: flex;
        justify-content: center;
        gap: 20px;
      }

      .line2 {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }

      body {
        width: 100%;
        margin: 0px;
        padding: 0;
        font-family: 'Orbitron', sans-serif;
      }

      ul,
      h4,
      h5 {
        margin: 0;
      }

      h3 {
        margin-top: 18px;
        margin-bottom: 0px;
        font-size: 24px;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        margin: 20px 0;
        border-radius: 12px;
        overflow: hidden;
      }

      td,
      th {
        height: 40px;
        text-align: center;
        font-size: 16px;
        transition: 0.3s ease;
      }

      input[type="text"],
      input[type="number"] {
        width: 98%;
        height: 100%;
        border: none;
        background-color: transparent;
        font-size: 16px;
        text-align: center;
        outline: none;
      }

      .ul>li {
        font-size: 12px;
      }

      .readonly {
        /* background: linear-gradient(to right, #ff6ec7, #a770ef); */

      }

      button {
        border: none;
        border-radius: 8px;
        width: 110px;
        height: 35px;
        font-size: 14px;
        cursor: pointer;
        transition: transform 0.2s ease;
      }



      .checkbox {
        -webkit-appearance: none;
        -moz-appearance: none;
        outline: none;
        width: 14px;
        height: 14px;
        background-color: transparent;
        border-radius: 4px;
        cursor: pointer;
      }

      .checkbox:checked {}

      #emoji-container {
        position: absolute;
        pointer-events: none;
        width: 100vw;
        height: 100vh;
      }

      .emoji {
        position: absolute;
        font-size: 24px;
        animation: fly 2s forwards;
      }
    }



    @media (max-width: 768px) {
      html {
        font-size: calc((100 / 375)*100vw*0.1);
      }

      body {
        width: 100%;
        margin: 0px;
        padding: 0;
        padding-top: 2rem;
        /* background: radial-gradient(circle at top left, #08061a, #1e1a3c, #161623); */
        /* color: #e0e0e0; */
        font-family: 'Orbitron', sans-serif;
        /* text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff; */
      }

      h1 {
        margin-top: 1.6rem;
        font-size: 2.5rem;
        /* text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff; */
      }

      ul,
      h4,
      h5 {
        margin: 0;
        /* text-shadow: 0 0 5px #00ffff; */
      }

      h3 {
        font-size: 1.6rem;
        margin-top: 1.8rem;
        margin-bottom: 0px;
        /* color: #ff00cc; */
        /* text-shadow: 0 0 1px #ff00cc, 0 0 5px #ff00cc; */
      }

      table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 1rem;
        margin-top: 1.8rem;
        /* background: rgba(255, 255, 255, 0.05); */
        backdrop-filter: blur(6px);
        border-radius: 12px;
        /* box-shadow: 0 0 10px #00e5ff, 0 0 20px #ff00ff; */
        overflow: hidden;
      }

      td,
      th {
        /* border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(0, 0, 0, 0.4);
    color: #00f0ff; */
        height: 3rem;
        text-align: center;
        font-size: 1.9rem;
        /* text-shadow: 0 0 4px #00ffff; */
      }

      input[type="text"],
      input[type="number"] {
        width: 6rem;
        height: 100%;
        border: none;
        background-color: transparent;
        /* color: #fff; */
        font-size: 1.9rem;
        text-align: center;
        outline: none;
        /* text-shadow: 0 0 3px #fff; */
      }

      ul>li {
        font-size: 1.6rem;
      }

      .ul>li {
        font-size: 1.2rem;
        /* color: #a0faff;
    text-shadow: 0 0 2px #a0faff; */
      }

      .readonly {
        /* background-color: rgba(0, 0, 0, 0.6); */
        /* color: #fff; */
        /* border: 1px solid rgba(255, 255, 255, 0.2); */
      }

      #emoji-container {
        position: absolute;
        pointer-events: none;
        width: 100vw;
        height: 100vh;
      }

      .emoji {
        position: absolute;
        font-size: 0rem;
        animation: fly 2s forwards;
        /* text-shadow: 0 0 10px #fff; */
      }

      button {
        /* background: linear-gradient(135deg, #ff00cc, #3333ff); */
        border: none;
        color: white;
        border-radius: 0.8rem;
        font-size: 2rem;
        padding: 0.5rem 1rem;
        /* box-shadow: 0 0 10px #ff00cc, 0 0 20px #3333ff; */
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      /* button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #00ffff, 0 0 30px #ff00ff;
  } */

      .copybtn,
      .exportbtn {
        width: 100%;
        text-align: center;
        padding: 0.5rem 0;
        margin-top: 1rem;
      }

      .checkbox {
        -webkit-appearance: none;
        -moz-appearance: none;
        outline: none;
        width: 2rem;
        height: 2rem;
        background-color: transparent;
        /* border: 2px solid #00ffff; */
        border-radius: 1rem;
        /* box-shadow: 0 0 5px #00ffff; */
        cursor: pointer;
        vertical-align: middle;
        transition: all 0.3s ease;
      }

      .checkbox:checked {
        /* background-color: #00ffff; */
        /* box-shadow: 0 0 10px #00ffff; */
        vertical-align: middle;
      }

      .line1 {
        display: flex;
        justify-content: center;
        gap: 2rem;
      }

      .line1 span {
        font-size: 1.8rem;
        vertical-align: middle;
      }

      .line2 {
        margin-top: 2rem;
        display: flex;
        justify-content: space-around;
      }
    }




    #input {
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      z-index: -10;
    }
  </style>
</head>

<body>
  <!-- <div id="emoji-container"></div> -->
  <h1 style="text-align: center;margin-top: 0;">Calorie Mahjong Calculator</h1>
  <div class="line1">
    <label><input type="checkbox" id="useRandom" class="checkbox" onchange="saveToCookies()"><span>æ˜¯å¦å¼€å¯éšæœºæ•°</span>
    </label>
    <label><input type="checkbox" id="useRandom2" class="checkbox" onchange="saveToCookies()"><span>æ˜¯å¦å¼€å¯éšæœºåŠ æ•°</span>
    </label>
  </div>
  <div class="line2">
    <button onclick="calculate()">è®¡ç®—</button>
    <button onclick="addRow()">æ·»åŠ æ•°æ®è¡Œ</button>
    <button onclick="clearAll()">æ¸…ç©º</button>
  </div>

  <table id="dataTable">
    <thead>
      <tr id="headerRow">
        <th>é¡¹ç›®</th>
        <td ondblclick="editName(this, 0)" id="name1">äººå1</td>
        <td ondblclick="editName(this, 1)" id="name2">äººå2</td>
        <td ondblclick="editName(this, 2)" id="name3">äººå3</td>
        <td ondblclick="editName(this, 3)" id="name4">äººå4</td>
      </tr>
    </thead>
    <tbody id="inputRows">
      <tr>
        <th>ç¬¬1å±€</th>
        <td><input type="number" min="0" oninput="saveToCookies()"></td>
        <td><input type="number" min="0" oninput="saveToCookies()"></td>
        <td><input type="number" min="0" oninput="saveToCookies()"></td>
        <td><input type="number" min="0" oninput="saveToCookies()"></td>
      </tr>
    </tbody>
    <tfoot>
      <tr id="randomAddRow">
        <th>éšæœºåŠ æ•°</th>
        <td class="readonly" id="r1_1"></td>
        <td class="readonly" id="r1_2"></td>
        <td class="readonly" id="r1_3"></td>
        <td class="readonly" id="r1_4"></td>
      </tr>
      <tr id="randomRow">
        <th>éšæœºæ•°</th>
        <td class="readonly" id="r2_1"></td>
        <td class="readonly" id="r2_2"></td>
        <td class="readonly" id="r2_3"></td>
        <td class="readonly" id="r2_4"></td>
      </tr>
      <tr id="sumRow">
        <th>æ€»å’Œ</th>
        <td class="readonly" id="all1"></td>
        <td class="readonly" id="all2"></td>
        <td class="readonly" id="all3"></td>
        <td class="readonly" id="all4"></td>
      </tr>
    </tfoot>
  </table>
  <button class="copybtn" onclick="myFunction()">å¤åˆ¶æ–‡æœ¬</button>
  <button class="exportbtn" onclick="exportToExcel()">å¯¼å‡ºä¸ºExcel</button>
  <div>
    <h3>Random Number Probability Formula</h3>
    <ul>
      <li>Range: [0.00, 10.00]</li>
      <li>Increase 89.91%</li>
      <li>Decrease or No Change 9.99%</li>
      <li>Forgiveness 0.1%</li>
    </ul>
  </div>
  <div>
    <h3>Random Add Number Probability Formula</h3>
    <ul>
      <li>Range: [0.00, 25.00]</li>
      <li>Increase 95.96%</li>
      <li>Decrease or No Change 4%</li>
      <li>Forgiveness 0.04%</li>
    </ul>
  </div>
  <div>
    <h3>Thank the author ( Click to enlarge )</h3>
    <p style="text-indent:2em;">
      <img src="img.png" alt="" width="100px"
        onclick="this.style.width = this.style.width === '300px' ? '100px' : '300px'">
    </p>

  </div>
  <div>

    <h3>Update Log</h3>
    <ul>
      <li>
        <h5>06/16/2025</h5>
        <ul class="ul">
          <li>Added random theme switching</li>
          <li>Added included Dopamine color scheme</li>
        </ul>
      </li>
      <li>
        <h5>06/16/2025</h5>
        <ul class="ul">
          <li>Changed the entire webpage's theme again</li>
        </ul>
      </li>
      <li>
        <h5>06/16/2025</h5>
        <ul class="ul">
          <li>Due to complaints, the color scheme has been changed to a normal one</li>
          <li>YOU DON'T UNDERSTAND ART!!!</li>
        </ul>
      </li>
      <li>
        <h5>06/15/2025</h5>
        <ul class="ul">
          <li>Add export table to Excel</li>
        </ul>
      </li>
      <li>
        <h5>06/15/2025</h5>
        <ul class="ul">
          <li>Add copy text functionality</li>
        </ul>
      </li>
      <li>
        <h5>06/15/2025</h5>
        <ul class="ul">
          <li>Changed the entire webpage's theme to express my anger</li>
        </ul>
      </li>
      <li>
        <h5>06/11/2025</h5>
        <ul class="ul">
          <li>Add Easter Egg</li>
        </ul>
      </li>
      <li>
        <h5>06/10/2025</h5>
        <ul class="ul">
          <li>Apply the same restriction to the name in the cookie</li>
        </ul>
      </li>
      <li>
        <h5>06/09/2025</h5>
        <ul class="ul">
          <li>Add random increment, there will be a penalty even with a full win</li>
          <li>No way to escape</li>
          <li>Good luck :P</li>
        </ul>
      </li>
      <li>
        <h5>06/09/2025</h5>
        <ul class="ul">
          <li>Rounded random numbers to two decimal places</li>
          <li>Added probability formula</li>
          <li>Changed naming conventions</li>
        </ul>
      </li>
    </ul>

  </div>
  <!-- <input type="text" id="input" > -->
  <textarea name="" id="input"></textarea>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    function getTodayDate() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0'); // æœˆä»½ä»0å¼€å§‹
      const day = String(now.getDate()).padStart(2, '0');
      return `${year}_${month}_${day}`;
    }
    function exportToExcel() {
      // 1. è·å– HTML è¡¨æ ¼
      var table = document.getElementById("dataTable");

      // 2. è§£æä¸º Sheet
      var wb = XLSX.utils.table_to_book(table, { sheet: "æ•°æ®è¡¨æ ¼" });

      // 3. ç”ŸæˆçœŸæ­£çš„ .xlsx æ–‡ä»¶
      XLSX.writeFile(wb, `å¡è·¯é‡Œéº»å°†_${getTodayDate()}.xlsx`);
    }
    function myFunction() {
      /* è·å–æ–‡æœ¬å†…å®¹ */
      // var text = document.getElementById("name1").innerHTML;
      let text = '';
      for (let i = 1; i <= 4; i++) {
        text += `åç§°ï¼š${document.getElementById("name" + i).innerHTML} `
        if (randomGenerated2) {
          text += `éšæœºåŠ æ•°ï¼š${document.getElementById("r1_" + i).innerHTML} `
        }
        if (randomGenerated) {
          text += `éšæœºä¹˜æ•°ï¼š${document.getElementById("r2_" + i).innerHTML} `
        }
        text += `æ€»è®¡ï¼š${document.getElementById("all" + i).innerHTML} \n`
      }
      var input = document.getElementById("input");
      input.value = text;
      input.select();//é€‰ä¸­æ–‡æœ¬
      document.execCommand("copy");
    }
    let randomGenerated = false; //ä¹˜æ•°
    let randomGenerated2 = false; //åŠ æ•°
    let randomValues = [];
    let randomValues2 = [];

    // === å¯ç¼–è¾‘äººå ===
    function editName(cell, index) {
      const currentName = cell.innerText;
      const input = document.createElement("input");
      input.type = "text";
      input.value = currentName;
      input.onblur = function () {
        const maxLength = 6;
        let inputValue = this.value;
        let str = handleTextLength(inputValue, maxLength);
        cell.innerText = str || currentName;
        cell.ondblclick = () => editName(cell, index);
        saveToCookies();
      };
      cell.innerText = "";
      cell.appendChild(input);
      input.focus();
    }
    function calculateStringLength(str) {
      let length = 0;
      for (let i = 0; i < str.length; i++) {
        const charCode = str.charCodeAt(i);
        // å‡è®¾è‹±æ–‡å­—ç¬¦çš„ASCIIç èŒƒå›´æ˜¯32åˆ°126
        if (charCode >= 32 && charCode <= 126) {
          length += 0.5; // è‹±æ–‡å­—ç¬¦ç®—ä½œåŠä¸ªé•¿åº¦
        } else {
          length += 1; // å…¶ä»–å­—ç¬¦ç®—ä½œä¸€ä¸ªé•¿åº¦
        }
      }
      return length;
    }
    function handleTextLength(text, maxLength) {
      let length = 0;
      let result = '';
      if (calculateStringLength(text) > 10) {
        return 'è¿™ä¹ˆé•¿åç»™è°çœ‹';
      }
      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        length += (calculateStringLength(char) === 0.5) ? 0.5 : 1;  // è‹±æ–‡å­—ç¬¦ä¸º0.5ï¼Œå…¶ä»–ä¸º1

        if (length > maxLength) {
          break;  // å¦‚æœè¶…å‡ºæœ€å¤§é•¿åº¦ï¼Œåœæ­¢
        }

        result += char;
      }

      return result;
    }
    // === æ·»åŠ æ•°æ®è¡Œ ===
    function addRow() {
      const inputRows = document.getElementById("inputRows");
      const rowCount = inputRows.rows.length + 1;
      const newRow = document.createElement("tr");

      const headerCell = document.createElement("th");
      headerCell.textContent = `ç¬¬${rowCount}å±€`;
      newRow.appendChild(headerCell);

      for (let i = 0; i < 4; i++) {
        const cell = document.createElement("td");
        const input = document.createElement("input");
        input.type = "number";
        input.min = 0;
        input.oninput = saveToCookies;
        cell.appendChild(input);
        newRow.appendChild(cell);
      }

      inputRows.appendChild(newRow);
      saveToCookies();
    }

    // === è®¡ç®—é€»è¾‘ ===
    function calculate() {
      const useRandom = document.getElementById("useRandom").checked;
      const useRandom2 = document.getElementById("useRandom2").checked;
      const inputRows = document.getElementById("inputRows").rows;
      const sumRow = document.getElementById("sumRow").cells;
      const randomRow = document.getElementById("randomRow").cells;
      const randomRow2 = document.getElementById("randomAddRow").cells;

      if (!randomGenerated) {
        randomValues = [];
        randomValues2 = [];
        for (let i = 1; i <= 4; i++) {
          const rand = parseFloat((Math.random() * 10).toFixed(2));
          randomValues.push(rand);
          randomRow[i].textContent = rand;
        }
        randomGenerated = true;
        saveToCookies();
      }
      if (!randomGenerated2) {
        randomValues2 = [];
        for (let i = 1; i <= 4; i++) {
          const rand2 = parseFloat((Math.random() * 25).toFixed(2));
          randomValues2.push(rand2);
          randomRow2[i].textContent = rand2;
        }
        randomGenerated2 = true;
        saveToCookies();
      }

      for (let col = 1; col <= 4; col++) {
        let sum = 0;
        if (!isNaN(randomValues2[col - 1]) && useRandom2) {
          sum += randomValues2[col - 1]
        }
        for (let row = 0; row < inputRows.length; row++) {
          const input = inputRows[row].cells[col].querySelector("input");
          const value = parseFloat(input.value);
          if (!isNaN(value)) sum += value;
        }
        if (useRandom) {
          sum *= randomValues[col - 1];
        }
        sumRow[col].textContent = sum.toFixed(2);
      }
    }

    // === ä¿å­˜åˆ° cookie ===
    function saveToCookies() {
      const data = {
        names: [],
        inputs: [],
        randomValues: randomValues,
        randomValues2: randomValues2,
        useRandom: document.getElementById("useRandom").checked,
        useRandom2: document.getElementById("useRandom2").checked
      };

      // ä¿å­˜äººå
      const headerCells = document.querySelectorAll("#headerRow td");
      headerCells.forEach(cell => data.names.push(cell.innerText));

      // ä¿å­˜è¾“å…¥æ•°æ®
      const inputRows = document.getElementById("inputRows").rows;
      for (let i = 0; i < inputRows.length; i++) {
        const row = inputRows[i];
        const rowData = [];
        for (let j = 1; j <= 4; j++) {
          const input = row.cells[j].querySelector("input");
          rowData.push(input.value);
        }
        data.inputs.push(rowData);
      }

      document.cookie = "tableData=" + encodeURIComponent(JSON.stringify(data)) + ";path=/;max-age=31536000";
    }

    // === åŠ è½½ cookie ===
    function loadFromCookies() {
      const cookie = document.cookie.split("; ").find(row => row.startsWith("tableData="));
      if (!cookie) return;

      try {
        const data = JSON.parse(decodeURIComponent(cookie.split("=")[1]));

        // è®¾ç½®äººå
        const headerCells = document.querySelectorAll("#headerRow td");
        data.names.forEach((name, i) => {
          if (headerCells[i]) headerCells[i].innerText = handleTextLength(name, 6);
        });

        // æ·»åŠ è¡Œå¹¶å¡«å…¥æ•°æ®
        const tbody = document.getElementById("inputRows");
        while (tbody.rows.length < data.inputs.length) {
          addRow();
        }

        for (let i = 0; i < data.inputs.length; i++) {
          for (let j = 0; j < 4; j++) {
            const cell = tbody.rows[i].cells[j + 1];
            const input = cell.querySelector("input");
            input.value = data.inputs[i][j];
          }
        }

        // æ¢å¤éšæœºæ•°
        if (data.randomValues && data.randomValues.length === 4) {
          randomValues = data.randomValues;
          randomGenerated = true;
          const randomRow = document.getElementById("randomRow").cells;
          for (let i = 1; i <= 4; i++) {
            randomRow[i].textContent = randomValues[i - 1];
          }
        }
        if (data.randomValues2 && data.randomValues2.length === 4) {
          randomValues2 = data.randomValues2;
          randomGenerated2 = true;
          const randomRow2 = document.getElementById("randomAddRow").cells;
          for (let i = 1; i <= 4; i++) {
            randomRow2[i].textContent = randomValues2[i - 1];
          }
        }

        // æ¢å¤éšæœºæ•°é€‰é¡¹
        document.getElementById("useRandom").checked = data.useRandom;
        document.getElementById("useRandom2").checked = data.useRandom2;
      } catch (e) {
        console.error("è§£æ cookie æ•°æ®å¤±è´¥ï¼š", e);
      }
    }

    // === æ¸…ç©ºæ•°æ® ===
    function clearAll() {
      document.cookie = "tableData=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      location.reload();
    }

    window.onload = loadFromCookies;
    const emojiContainer = document.getElementById('emoji-container');
    const emojis = ['ğŸ˜Š', 'ğŸ˜‚', 'ğŸ˜', 'ğŸ¥º', 'ğŸ˜', 'ğŸ¤”', 'ğŸ˜œ', 'ğŸ™ƒ', 'ğŸ˜‡'];
    document.body.addEventListener('click', (e) => {
      // è·å–ç‚¹å‡»ä½ç½®
      const x = e.clientX;
      const y = e.clientY - 25;

      // éšæœºé€‰æ‹©ä¸€ä¸ª emoji
      const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];

      // åˆ›å»º emoji å…ƒç´ 
      const emoji = document.createElement('div');
      emoji.classList.add('emoji');
      emoji.textContent = randomEmoji;

      // éšæœºç”Ÿæˆç›®æ ‡ä½ç½®ï¼ˆé£å‡ºçš„æ–¹å‘ï¼‰
      const randomX = Math.random() * 100 - 50;  // éšæœºæ°´å¹³åç§»
      const randomY = -Math.random() * 100;  // éšæœºå‚ç›´åç§»

      // è®¾ç½®åŠ¨ç”»çš„ç›®æ ‡ä½ç½®
      emoji.style.setProperty('--x', `${randomX}px`);
      emoji.style.setProperty('--y', `${randomY}px`);
      emoji.style.userSelect = 'none';
      // è®¾ç½® emoji åˆå§‹ä½ç½®
      emoji.style.left = `${x - 12}px`;  // å‡å» emoji å®½åº¦çš„ä¸€åŠ
      emoji.style.top = `${y - 12}px`;   // å‡å» emoji é«˜åº¦çš„ä¸€åŠ

      // æ·»åŠ åˆ°å®¹å™¨ä¸­
      document.body.appendChild(emoji);

      // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
      emoji.addEventListener('animationend', () => {
        emoji.remove();
      });
    });
  </script>

</body>

</html>